<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrestling PWA - Test Suite</title>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background: #1a1a1a;
            color: #f0f0f0;
        }
        .test-results {
            margin: 20px 0;
        }
        .test-group {
            margin: 20px 0;
            padding: 10px;
            border-left: 4px solid #666;
        }
        .test-group.pass {
            border-left-color: #4CAF50;
        }
        .test-group.fail {
            border-left-color: #f44336;
        }
        .test-case {
            margin: 5px 0;
            padding: 5px;
        }
        .test-case.pass {
            color: #4CAF50;
        }
        .test-case.fail {
            color: #f44336;
        }
        .test-case.pending {
            color: #ff9800;
        }
        .summary {
            margin-top: 30px;
            padding: 15px;
            background: #333;
            border-radius: 5px;
        }
        .run-tests {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .run-tests:hover {
            background: #45a049;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <h1>Wrestling PWA Test Suite</h1>
    <p>Testing harness for vanilla JS PWA functionality</p>

    <button class="run-tests" onclick="runAllTests()">Run All Tests</button>

    <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="test-results" id="testResults">
        <p>Click "Run All Tests" to start testing...</p>
    </div>

    <!-- Mock DOM elements for form tests -->
    <div style="display: none;">
        <form id="practice-form">
            <select id="practice-type">
                <option value="drills">Drills/Technique</option>
                <option value="live">Live Sparring/Rolling</option>
                <option value="conditioning">Conditioning/Strength</option>
                <option value="competition">Competition</option>
            </select>
            <input id="practice-date" type="date" value="2025-10-01">
            <input id="practice-duration" type="number" min="1">
            <input id="practice-intensity" type="range" min="1" max="10" value="5">
            <span id="intensity-value">5</span>
            <input id="practice-physical" type="range" min="1" max="5" value="3">
            <span id="physical-value">3</span>
            <input id="practice-mental" type="range" min="1" max="5" value="3">
            <span id="mental-value">3</span>
            <textarea id="practice-notes"></textarea>
            <button type="button" class="preset-btn" data-duration="60">60</button>
            <button type="button" class="preset-btn" data-duration="90">90</button>
            <button type="button" class="preset-btn" data-duration="120">120</button>
        </form>
    </div>

    <div class="summary" id="summary" style="display: none;">
        <h2>Test Summary</h2>
        <p id="summaryText"></p>
    </div>

    <!-- Load test framework -->
    <script src="test-framework.js"></script>

    <!-- Load db.js for database tests -->
    <script type="module" src="../docs/db.js"></script>

    <!-- Load test files -->
    <script src="tests/db-tests.js"></script>
    <script src="tests/pwa-tests.js"></script>
    <script src="tests/form-tests.js"></script>
    <script src="tests/badge-tests.js"></script>

    <script>
        async function runAllTests() {
            const resultsDiv = document.getElementById('testResults');
            const progressBar = document.getElementById('progressBar');
            const summaryDiv = document.getElementById('summary');
            const summaryText = document.getElementById('summaryText');

            resultsDiv.innerHTML = '<p>Running tests...</p>';
            summaryDiv.style.display = 'none';
            progressBar.style.width = '0%';

            try {
                const results = await TestRunner.runAll();
                displayResults(results);
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: #f44336;">Test runner failed: ${error.message}</p>`;
            }
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('testResults');
            const progressBar = document.getElementById('progressBar');
            const summaryDiv = document.getElementById('summary');
            const summaryText = document.getElementById('summaryText');

            let html = '';
            let totalTests = 0;
            let passedTests = 0;

            results.forEach(group => {
                const groupClass = group.failed === 0 ? 'pass' : 'fail';
                html += `<div class="test-group ${groupClass}">`;
                html += `<h3>${group.name}</h3>`;

                group.tests.forEach(test => {
                    totalTests++;
                    const testClass = test.status === 'pass' ? 'pass' : test.status === 'fail' ? 'fail' : 'pending';
                    if (test.status === 'pass') passedTests++;

                    html += `<div class="test-case ${testClass}">`;
                    html += `<strong>${test.name}:</strong> ${test.status}`;
                    if (test.error) {
                        html += `<br><small style="color: #f44336;">${test.error}</small>`;
                    }
                    html += `</div>`;
                });

                html += `</div>`;
            });

            resultsDiv.innerHTML = html;

            const passRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            summaryText.innerHTML = `Total Tests: ${totalTests}<br>Passed: ${passedTests}<br>Failed: ${totalTests - passedTests}<br>Pass Rate: ${passRate}%`;
            summaryDiv.style.display = 'block';

            progressBar.style.width = `${passRate}%`;
            progressBar.style.background = passRate === 100 ? '#4CAF50' : passRate >= 70 ? '#ff9800' : '#f44336';
        }
    </script>
</body>
</html>