<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MatMind PWA</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Favicon -->
    <link rel="icon" href="WrestleIcon.png">
    <link rel="apple-touch-icon" href="WrestleIcon.png">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-900 text-slate-200 font-sans h-screen overflow-hidden flex flex-col">

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-50 bg-slate-900 flex items-center justify-center flex-col gap-4">
        <i data-lucide="activity" class="w-12 h-12 text-amber-500 animate-pulse"></i>
        <p class="text-slate-400 font-medium animate-pulse">Warming up...</p>
    </div>

    <!-- Auth error banner (hidden by default) -->
    <div id="auth-error-banner" class="hidden fixed top-16 left-1/2 -translate-x-1/2 bg-amber-500/10 text-amber-300 px-4 py-2 rounded-lg z-50 text-sm border border-amber-600/20"></div>
    <!-- Firestore error banner (hidden by default) -->
    <div id="firestore-error-banner" class="hidden fixed top-20 left-1/2 -translate-x-1/2 bg-red-600/10 text-red-400 px-4 py-2 rounded-lg z-50 text-sm border border-red-600/20"></div>

    <!-- Main Content Area -->
    <div id="sync-indicator" class="fixed top-4 right-4 z-50 bg-slate-800/80 px-3 py-1 rounded-full text-xs text-slate-200 border border-slate-700">
        Checking network...
    </div>
    <main id="app-container" class="flex-1 overflow-y-auto hide-scrollbar relative max-w-md mx-auto w-full pb-24">
        
        <!-- VIEW: Dashboard -->
        <div id="view-dashboard" class="p-4 space-y-6 animate-fade-in">
            <!-- Level Card -->
            <div class="bg-slate-800 rounded-2xl p-6 shadow-lg border border-slate-700 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i data-lucide="trophy" class="w-24 h-24 text-amber-500"></i>
                </div>
                <div class="relative z-10">
                    <h2 class="text-slate-400 text-sm uppercase tracking-widest font-bold mb-1">Current Status</h2>
                    <h1 id="level-name" class="text-3xl font-black mb-2">Rookie</h1>
                    
                    <div class="flex items-end gap-2 mb-2">
                        <span id="total-hours" class="text-4xl font-light text-white">0.0</span>
                        <span class="text-slate-500 font-medium mb-1">total mat hours</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="h-2 w-full bg-slate-800 rounded-full overflow-hidden bg-slate-900/50">
                        <div id="level-progress" class="h-full bg-amber-500 transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-slate-500">
                        <span id="hours-current">0 hrs</span>
                        <span id="hours-next">Next Rank: 10 hrs</span>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 flex flex-col justify-between">
                    <div class="flex justify-between items-start mb-2">
                        <i data-lucide="flame" class="text-orange-500 w-5 h-5"></i>
                        <span class="text-slate-500 text-xs font-bold">7 DAYS</span>
                    </div>
                    <div>
                        <span id="weekly-count" class="text-2xl font-bold text-white">0</span>
                        <span class="text-slate-400 text-sm ml-1">sessions</span>
                    </div>
                </div>
                
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 flex flex-col justify-between">
                    <div class="flex justify-between items-start mb-2">
                        <i data-lucide="brain" class="text-purple-500 w-5 h-5"></i>
                        <span class="text-slate-500 text-xs font-bold">INSIGHTS</span>
                    </div>
                    <div>
                        <span id="insight-count" class="text-2xl font-bold text-white">0</span>
                        <span class="text-slate-400 text-sm ml-1">patterns</span>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Header -->
                <div class="flex justify-between items-center mt-2">
                    <h3 class="text-white font-bold text-lg">Recent Mat Time</h3>
                    <div class="flex items-center gap-2">
                        <button id="btn-import" class="py-2 px-3 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-xs">Import Backup</button>
                        <button class="nav-link text-amber-500 text-sm font-medium" data-target="journal">View All</button>
                    </div>
                </div>
            
            <div id="recent-list" class="space-y-3">
                <!-- Recent items injected here -->
            </div>
        </div>

        <!-- VIEW: Log Session -->
        <div id="view-log" class="hidden p-4 space-y-6 animate-fade-in">
            <h2 class="text-2xl font-bold text-white">Log Session</h2>
                        <div class="flex items-center gap-2">
                            <button id="btn-sample" type="button" class="ml-auto py-2 px-3 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-sm">Quick Sample</button>
                        </div>
            <form id="log-form" class="space-y-6">
                <!-- Type & Duration -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-slate-400 text-xs uppercase font-bold">Type</label>
                        <select id="inp-type" class="w-full bg-slate-800 text-white p-3 rounded-xl border border-slate-700 focus:border-amber-500 outline-none appearance-none">
                            <option>Practice</option>
                            <option>Drilling</option>
                            <option>Live Wrestling</option>
                            <option>Conditioning</option>
                            <option>Competition</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-slate-400 text-xs uppercase font-bold">Duration (Min)</label>
                        <input id="inp-duration" type="number" value="90" class="w-full bg-slate-800 text-white p-3 rounded-xl border border-slate-700 focus:border-amber-500 outline-none">
                    </div>
                </div>

                <!-- Intensity -->
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <label class="text-slate-400 text-xs uppercase font-bold">Intensity (RPE)</label>
                        <span id="val-intensity" class="text-xs font-bold text-amber-400">5/10</span>
                    </div>
                    <input id="inp-intensity" type="range" min="1" max="10" value="5" class="w-full">
                    <div class="flex justify-between text-[10px] text-slate-500 px-1">
                        <span>Light</span>
                        <span>Grueling</span>
                    </div>
                </div>

                                <!-- Notes -->
                                <div class="space-y-2">
                                        <label class="text-slate-400 text-xs uppercase font-bold">Notes</label>
                                        <textarea id="inp-notes" placeholder="What happened, what you learned, and any notes..." class="w-full h-24 bg-slate-800 text-white p-3 rounded-xl border border-slate-700 focus:border-amber-500 outline-none resize-none"></textarea>
                                </div>

                                <!-- Physical & Mental Feel -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <label class="text-slate-400 text-xs uppercase font-bold">Physical Feel</label>
                                            <span id="val-physical" class="text-xs font-bold text-amber-400">5/10</span>
                                        </div>
                                        <input id="inp-physical" type="range" min="1" max="10" value="5" class="w-full">
                                    </div>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <label class="text-slate-400 text-xs uppercase font-bold">Mental Feel</label>
                                            <span id="val-mental" class="text-xs font-bold text-amber-400">7/10</span>
                                        </div>
                                        <input id="inp-mental" type="range" min="1" max="10" value="7" class="w-full">
                                    </div>
                                </div>

                <button type="submit" class="w-full py-4 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold rounded-xl flex items-center justify-center gap-2 transition-transform active:scale-95 shadow-lg shadow-amber-500/20">
                    <i data-lucide="save" class="w-5 h-5"></i> Log Session
                </button>
            </form>
        </div>

        <!-- VIEW: Journal -->
        <div id="view-journal" class="hidden p-4 space-y-4 animate-fade-in">
            <h2 class="text-2xl font-bold text-white mb-2">Mat Journal</h2>
            <div id="journal-list" class="space-y-4 pb-20">
                <!-- Journal items injected here -->
            </div>
        </div>

        <!-- VIEW: Insights -->
        <div id="view-insights" class="hidden p-4 space-y-6 animate-fade-in">
            <h2 class="text-2xl font-bold text-white">Coach's Corner</h2>
            
            <!-- Analysis Card -->
            <div class="bg-gradient-to-br from-indigo-900 to-slate-900 p-6 rounded-2xl border border-indigo-500/30">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex items-center gap-3 mr-4">
                        <i data-lucide="bar-chart-2" class="w-6 h-6 text-indigo-300"></i>
                        <div>
                            <h3 class="text-white font-bold">Weekly Digest</h3>
                            <p class="text-indigo-200 text-sm">Small analysis of recent sessions</p>
                        </div>
                    </div>
                    <div class="ml-auto text-right">
                        <div class="text-sm text-indigo-200">Avg Intensity</div>
                        <div id="avg-intensity" class="text-lg font-semibold text-white">0.0 / 5</div>
                    </div>
                </div>

                <div id="insights-content" class="mt-4 text-sm text-indigo-100">
                    <p class="italic text-indigo-200">Log more sessions to receive personalized insights and patterns.</p>
                </div>

                <div class="flex justify-between items-center mt-6 text-sm text-indigo-200">
                    <div>
                        <div class="text-xs text-slate-400">This week</div>
                        <div id="weekly-hours" class="text-white font-bold text-lg">0.0 hrs</div>
                    </div>
                    <div id="volume-msg" class="text-right text-indigo-100">Time to get back on the mat.</div>
                </div>
            </div>
        </div> <!-- close view-insights -->
    </main>

    <!-- Floating Action Button (used to open log view) -->
    <button id="fab" aria-label="Log new session" class="fixed bottom-24 right-4 p-3 rounded-full bg-amber-500 text-slate-900 shadow-lg z-40">
        <i data-lucide="plus" class="w-5 h-5"></i>
    </button>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-700 h-16 flex items-center justify-between max-w-md mx-auto px-4">
        <button class="nav-btn group flex flex-col items-center justify-center w-full h-full text-amber-500" data-target="dashboard">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span class="text-xs">Home</span>
        </button>
        <button class="nav-btn group flex flex-col items-center justify-center w-full h-full text-slate-500" data-target="journal">
            <i data-lucide="book-open" class="w-5 h-5"></i>
            <span class="text-xs">Journal</span>
        </button>
        <button class="nav-btn group flex flex-col items-center justify-center w-full h-full text-slate-500" data-target="insights">
            <i data-lucide="bar-chart-2" class="w-5 h-5"></i>
            <span class="text-xs">Insights</span>
        </button>
    </nav>

    <!-- Hidden import input -->
    <input id="file-import" type="file" accept=".json,application/json" style="display:none" />
    <!-- Module entry -->
    <script type="module" src="js/app.js"></script>
    <!-- Toast notification -->
    <div id="toast" class="hidden fixed bottom-28 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-4 py-2 rounded-lg z-50 text-sm"></div>
</body>
</html>